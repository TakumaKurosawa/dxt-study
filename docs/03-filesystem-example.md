# ÂÆüË∑µ‰æãÔºö„Éï„Ç°„Ç§„É´„Ç∑„Çπ„ÉÜ„É†ÈÄ£Êê∫

## üéØ ÁõÆÊ®ô

„Åì„ÅÆ„Ç¨„Ç§„Éâ„Åß„ÅØ„ÄÅ„É≠„Éº„Ç´„É´„Éï„Ç°„Ç§„É´„Ç∑„Çπ„ÉÜ„É†„Å®ÈÄ£Êê∫„Åô„Çã DXT Êã°ÂºµÊ©üËÉΩ„Çí‰ΩúÊàê„Åó„Åæ„Åô„ÄÇ„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøÂèñ„Çä„ÄÅÊõ∏„ÅçËæº„Åø„ÄÅÊ§úÁ¥¢„ÄÅÁµ±Ë®àÊÉÖÂ†±„ÅÆÂèñÂæó„Å™„Å©„ÅÆÊ©üËÉΩ„ÇíÂÆüË£Ö„Åó„Åæ„Åô„ÄÇ

## üìã Ê©üËÉΩÊ¶ÇË¶Å

‰ΩúÊàê„Åô„ÇãÊã°ÂºµÊ©üËÉΩ„ÅÆÊ©üËÉΩÔºö

- üìÅ „Éá„Ç£„É¨„ÇØ„Éà„É™ÂÜÖÂÆπ„ÅÆ‰∏ÄË¶ßË°®Á§∫
- üìÑ „Éï„Ç°„Ç§„É´ÂÜÖÂÆπ„ÅÆË™≠„ÅøÂèñ„Çä
- ‚úèÔ∏è „Éï„Ç°„Ç§„É´„ÅÆ‰ΩúÊàê„ÉªÁ∑®ÈõÜ
- üîç „Éï„Ç°„Ç§„É´ÂÜÖÂÆπ„ÅÆÊ§úÁ¥¢
- üìä „Éï„Ç°„Ç§„É´„Éª„Éá„Ç£„É¨„ÇØ„Éà„É™„ÅÆÁµ±Ë®àÊÉÖÂ†±
- üóëÔ∏è „Éï„Ç°„Ç§„É´„Éª„Éá„Ç£„É¨„ÇØ„Éà„É™„ÅÆÂâäÈô§

## üöÄ „Çπ„ÉÜ„ÉÉ„Éó 1: „Éó„É≠„Ç∏„Çß„ÇØ„Éà„ÅÆÂàùÊúüÂåñ

```bash
# Êñ∞„Åó„ÅÑ„Éó„É≠„Ç∏„Çß„ÇØ„Éà„Éá„Ç£„É¨„ÇØ„Éà„É™„Çí‰ΩúÊàê
mkdir filesystem-manager-dxt
cd filesystem-manager-dxt

# DXT„Éó„É≠„Ç∏„Çß„ÇØ„Éà„ÇíÂàùÊúüÂåñ
dxt init
```

ÂØæË©±ÂΩ¢Âºè„ÅÆÂÖ•ÂäõÔºö

```
? Extension name: filesystem-manager
? Display name: File System Manager
? Description: „É≠„Éº„Ç´„É´„Éï„Ç°„Ç§„É´„Ç∑„Çπ„ÉÜ„É†„Å®„ÅÆÂåÖÊã¨ÁöÑ„Å™ÈÄ£Êê∫„ÇíÊèê‰æõ
? Author name: Your Name
? Author email: your.email@example.com
? Version: 1.0.0
? License: MIT
? Extension type: node
```

## üìù „Çπ„ÉÜ„ÉÉ„Éó 2: manifest.json „ÅÆË®≠ÂÆö

„Çª„Ç≠„É•„É™„ÉÜ„Ç£Ë®≠ÂÆö„Å®„É¶„Éº„Ç∂„ÉºË®≠ÂÆö„ÇíËøΩÂä†„Åó„Åæ„ÅôÔºö

```json
{
  "dxt_version": "0.1",
  "name": "filesystem-manager",
  "display_name": "File System Manager",
  "version": "1.0.0",
  "description": "„É≠„Éº„Ç´„É´„Éï„Ç°„Ç§„É´„Ç∑„Çπ„ÉÜ„É†„Å®„ÅÆÂåÖÊã¨ÁöÑ„Å™ÈÄ£Êê∫„ÇíÊèê‰æõ",
  "author": {
    "name": "Your Name",
    "email": "your.email@example.com"
  },
  "license": "MIT",
  "server": {
    "type": "node",
    "entry_point": "server/index.js",
    "mcp_config": {
      "command": "node",
      "args": ["${__dirname}/server/index.js"],
      "env": {
        "ALLOWED_DIRECTORIES": "${user_config.allowed_directories}",
        "MAX_FILE_SIZE": "${user_config.max_file_size}",
        "SAFE_MODE": "${user_config.safe_mode}"
      }
    }
  },
  "user_config": {
    "allowed_directories": {
      "type": "string",
      "title": "Ë®±ÂèØ„Éá„Ç£„É¨„ÇØ„Éà„É™",
      "description": "„Ç¢„ÇØ„Çª„Çπ„ÇíË®±ÂèØ„Åô„Çã„Éá„Ç£„É¨„ÇØ„Éà„É™„ÅÆ„Éë„ÇπÔºà„Ç´„É≥„ÉûÂå∫Âàá„ÇäÔºâ",
      "default": "/Users/YOUR_USERNAME/Documents,/Users/YOUR_USERNAME/Desktop"
    },
    "max_file_size": {
      "type": "string",
      "title": "ÊúÄÂ§ß„Éï„Ç°„Ç§„É´„Çµ„Ç§„Ç∫",
      "description": "Ë™≠„ÅøÂèñ„ÇäÂèØËÉΩ„Å™ÊúÄÂ§ß„Éï„Ç°„Ç§„É´„Çµ„Ç§„Ç∫ÔºàMBÔºâ",
      "default": "10"
    },
    "safe_mode": {
      "type": "string",
      "title": "„Çª„Éº„Éï„É¢„Éº„Éâ",
      "description": "ÂâäÈô§Êìç‰Ωú„ÇíÁÑ°Âäπ„Å´„Åô„ÇãÔºàtrue/falseÔºâ",
      "default": "true"
    }
  },
  "tools": [
    {
      "name": "list_directory",
      "description": "„Éá„Ç£„É¨„ÇØ„Éà„É™„ÅÆÂÜÖÂÆπ„Çí‰∏ÄË¶ßË°®Á§∫"
    },
    {
      "name": "read_file",
      "description": "„Éï„Ç°„Ç§„É´„ÅÆÂÜÖÂÆπ„ÇíË™≠„ÅøÂèñ„Çä"
    },
    {
      "name": "write_file",
      "description": "„Éï„Ç°„Ç§„É´„ÅÆ‰ΩúÊàê„Åæ„Åü„ÅØÁ∑®ÈõÜ"
    },
    {
      "name": "search_files",
      "description": "„Éï„Ç°„Ç§„É´ÂÜÖÂÆπ„ÇÑ„Éï„Ç°„Ç§„É´Âêç„ÇíÊ§úÁ¥¢"
    },
    {
      "name": "get_file_stats",
      "description": "„Éï„Ç°„Ç§„É´„Éª„Éá„Ç£„É¨„ÇØ„Éà„É™„ÅÆÁµ±Ë®àÊÉÖÂ†±„ÇíÂèñÂæó"
    },
    {
      "name": "delete_file",
      "description": "„Éï„Ç°„Ç§„É´„Åæ„Åü„ÅØ„Éá„Ç£„É¨„ÇØ„Éà„É™„ÇíÂâäÈô§"
    }
  ]
}
```

## üîß „Çπ„ÉÜ„ÉÉ„Éó 3: package.json „ÅÆË®≠ÂÆö

`server/package.json`:

```json
{
  "name": "filesystem-manager-mcp-server",
  "version": "1.0.0",
  "type": "module",
  "main": "index.js",
  "dependencies": {
    "@modelcontextprotocol/sdk": "^1.0.0"
  }
}
```

## üíª „Çπ„ÉÜ„ÉÉ„Éó 4: „Çµ„Éº„Éê„ÉºÂÆüË£Ö

### „É°„Ç§„É≥„Çµ„Éº„Éê„Éº„Éï„Ç°„Ç§„É´

`server/index.js`:

```javascript
import { Server } from "@modelcontextprotocol/sdk/server/index.js";
import { StdioServerTransport } from "@modelcontextprotocol/sdk/server/stdio.js";
import {
  ListToolsRequestSchema,
  CallToolRequestSchema,
} from "@modelcontextprotocol/sdk/types.js";
import fs from "fs/promises";
import path from "path";
import { fileURLToPath } from "url";

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// Ë®≠ÂÆö„ÅÆË™≠„ÅøËæº„Åø
const ALLOWED_DIRECTORIES = process.env.ALLOWED_DIRECTORIES?.split(",") || [];
const MAX_FILE_SIZE = parseInt(process.env.MAX_FILE_SIZE || "10") * 1024 * 1024; // MB to bytes
const SAFE_MODE = process.env.SAFE_MODE === "true";

// MCP„Çµ„Éº„Éê„Éº„ÅÆ‰ΩúÊàê
const server = new Server(
  {
    name: "File System Manager Server",
    version: "1.0.0",
  },
  {
    capabilities: {
      tools: {},
    },
  }
);

// „Çª„Ç≠„É•„É™„ÉÜ„Ç£: „Éë„Çπ„ÅÆÊ§úË®º
function isPathAllowed(targetPath) {
  const normalizedPath = path.resolve(targetPath);
  return ALLOWED_DIRECTORIES.some((allowedDir) =>
    normalizedPath.startsWith(path.resolve(allowedDir))
  );
}

// „Éï„Ç°„Ç§„É´„Çµ„Ç§„Ç∫„ÅÆÊ§úË®º
async function isFileSizeAllowed(filePath) {
  try {
    const stats = await fs.stat(filePath);
    return stats.size <= MAX_FILE_SIZE;
  } catch {
    return false;
  }
}

// „ÉÑ„Éº„É´‰∏ÄË¶ß„ÅÆÂÆöÁæ©
server.setRequestHandler(ListToolsRequestSchema, async () => {
  return {
    tools: [
      {
        name: "list_directory",
        description: "„Éá„Ç£„É¨„ÇØ„Éà„É™„ÅÆÂÜÖÂÆπ„Çí‰∏ÄË¶ßË°®Á§∫„Åó„Åæ„Åô",
        inputSchema: {
          type: "object",
          properties: {
            directory_path: {
              type: "string",
              description: "„É™„Çπ„Éà„Åô„Çã„Éá„Ç£„É¨„ÇØ„Éà„É™„ÅÆ„Éë„Çπ",
            },
            show_hidden: {
              type: "boolean",
              description: "Èö†„Åó„Éï„Ç°„Ç§„É´„ÇíË°®Á§∫„Åô„Çã„Åã",
              default: false,
            },
            detailed: {
              type: "boolean",
              description: "Ë©≥Á¥∞ÊÉÖÂ†±„ÇíË°®Á§∫„Åô„Çã„Åã",
              default: false,
            },
          },
          required: ["directory_path"],
        },
      },
      {
        name: "read_file",
        description: "„Éï„Ç°„Ç§„É´„ÅÆÂÜÖÂÆπ„ÇíË™≠„ÅøÂèñ„Çä„Åæ„Åô",
        inputSchema: {
          type: "object",
          properties: {
            file_path: {
              type: "string",
              description: "Ë™≠„ÅøÂèñ„Çã„Éï„Ç°„Ç§„É´„ÅÆ„Éë„Çπ",
            },
            encoding: {
              type: "string",
              description: "„Éï„Ç°„Ç§„É´„ÅÆ„Ç®„É≥„Ç≥„Éº„Éá„Ç£„É≥„Ç∞",
              enum: ["utf8", "ascii", "base64"],
              default: "utf8",
            },
          },
          required: ["file_path"],
        },
      },
      {
        name: "write_file",
        description: "„Éï„Ç°„Ç§„É´„ÅÆ‰ΩúÊàê„Åæ„Åü„ÅØÁ∑®ÈõÜ„ÇíË°å„ÅÑ„Åæ„Åô",
        inputSchema: {
          type: "object",
          properties: {
            file_path: {
              type: "string",
              description: "Êõ∏„ÅçËæº„ÇÄ„Éï„Ç°„Ç§„É´„ÅÆ„Éë„Çπ",
            },
            content: {
              type: "string",
              description: "„Éï„Ç°„Ç§„É´„Å´Êõ∏„ÅçËæº„ÇÄÂÜÖÂÆπ",
            },
            encoding: {
              type: "string",
              description: "„Éï„Ç°„Ç§„É´„ÅÆ„Ç®„É≥„Ç≥„Éº„Éá„Ç£„É≥„Ç∞",
              enum: ["utf8", "ascii"],
              default: "utf8",
            },
            create_directories: {
              type: "boolean",
              description: "ÂøÖË¶Å„Å´Âøú„Åò„Å¶„Éá„Ç£„É¨„ÇØ„Éà„É™„Çí‰ΩúÊàê„Åô„Çã„Åã",
              default: true,
            },
          },
          required: ["file_path", "content"],
        },
      },
      {
        name: "search_files",
        description: "„Éï„Ç°„Ç§„É´ÂÜÖÂÆπ„ÇÑ„Éï„Ç°„Ç§„É´Âêç„ÇíÊ§úÁ¥¢„Åó„Åæ„Åô",
        inputSchema: {
          type: "object",
          properties: {
            search_directory: {
              type: "string",
              description: "Ê§úÁ¥¢„Åô„Çã„Éá„Ç£„É¨„ÇØ„Éà„É™„ÅÆ„Éë„Çπ",
            },
            query: {
              type: "string",
              description: "Ê§úÁ¥¢„ÇØ„Ç®„É™",
            },
            search_type: {
              type: "string",
              description: "Ê§úÁ¥¢„Çø„Ç§„Éó",
              enum: ["filename", "content", "both"],
              default: "both",
            },
            file_extensions: {
              type: "string",
              description: "Ê§úÁ¥¢ÂØæË±°„ÅÆ„Éï„Ç°„Ç§„É´Êã°ÂºµÂ≠êÔºà„Ç´„É≥„ÉûÂå∫Âàá„ÇäÔºâ",
              default: ".txt,.md,.js,.py,.json",
            },
            case_sensitive: {
              type: "boolean",
              description: "Â§ßÊñáÂ≠óÂ∞èÊñáÂ≠ó„ÇíÂå∫Âà•„Åô„Çã„Åã",
              default: false,
            },
          },
          required: ["search_directory", "query"],
        },
      },
      {
        name: "get_file_stats",
        description: "„Éï„Ç°„Ç§„É´„Éª„Éá„Ç£„É¨„ÇØ„Éà„É™„ÅÆÁµ±Ë®àÊÉÖÂ†±„ÇíÂèñÂæó„Åó„Åæ„Åô",
        inputSchema: {
          type: "object",
          properties: {
            target_path: {
              type: "string",
              description: "Áµ±Ë®àÊÉÖÂ†±„ÇíÂèñÂæó„Åô„Çã„Éë„Çπ",
            },
          },
          required: ["target_path"],
        },
      },
      {
        name: "delete_file",
        description: "„Éï„Ç°„Ç§„É´„Åæ„Åü„ÅØ„Éá„Ç£„É¨„ÇØ„Éà„É™„ÇíÂâäÈô§„Åó„Åæ„Åô",
        inputSchema: {
          type: "object",
          properties: {
            target_path: {
              type: "string",
              description: "ÂâäÈô§„Åô„Çã„Éï„Ç°„Ç§„É´„Éª„Éá„Ç£„É¨„ÇØ„Éà„É™„ÅÆ„Éë„Çπ",
            },
            recursive: {
              type: "boolean",
              description: "„Éá„Ç£„É¨„ÇØ„Éà„É™„ÇíÂÜçÂ∏∞ÁöÑ„Å´ÂâäÈô§„Åô„Çã„Åã",
              default: false,
            },
          },
          required: ["target_path"],
        },
      },
    ],
  };
});

// „ÉÑ„Éº„É´ÂÆüË°å„ÅÆ„Éè„É≥„Éâ„É©„Éº
server.setRequestHandler(CallToolRequestSchema, async (request) => {
  const { name, arguments: args } = request.params;

  try {
    switch (name) {
      case "list_directory":
        return await handleListDirectory(args);
      case "read_file":
        return await handleReadFile(args);
      case "write_file":
        return await handleWriteFile(args);
      case "search_files":
        return await handleSearchFiles(args);
      case "get_file_stats":
        return await handleGetFileStats(args);
      case "delete_file":
        return await handleDeleteFile(args);
      default:
        throw new Error(`Unknown tool: ${name}`);
    }
  } catch (error) {
    return {
      content: [
        {
          type: "text",
          text: `„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ${error.message}`,
        },
      ],
      isError: true,
    };
  }
});

// „Éá„Ç£„É¨„ÇØ„Éà„É™‰∏ÄË¶ß„ÅÆÂá¶ÁêÜ
async function handleListDirectory(args) {
  const { directory_path, show_hidden = false, detailed = false } = args;

  if (!isPathAllowed(directory_path)) {
    throw new Error("ÊåáÂÆö„Åï„Çå„Åü„Éá„Ç£„É¨„ÇØ„Éà„É™„Å∏„ÅÆ„Ç¢„ÇØ„Çª„Çπ„ÅåË®±ÂèØ„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì");
  }

  const items = await fs.readdir(directory_path);
  const filteredItems = show_hidden
    ? items
    : items.filter((item) => !item.startsWith("."));

  if (!detailed) {
    return {
      content: [
        {
          type: "text",
          text: `„Éá„Ç£„É¨„ÇØ„Éà„É™: ${directory_path}\n\n${filteredItems.join(
            "\n"
          )}`,
        },
      ],
    };
  }

  // Ë©≥Á¥∞ÊÉÖÂ†±„ÇíÂèñÂæó
  const detailedItems = await Promise.all(
    filteredItems.map(async (item) => {
      const itemPath = path.join(directory_path, item);
      try {
        const stats = await fs.stat(itemPath);
        return {
          name: item,
          type: stats.isDirectory() ? "directory" : "file",
          size: stats.size,
          modified: stats.mtime.toISOString(),
          permissions: stats.mode.toString(8),
        };
      } catch {
        return { name: item, type: "unknown", error: "„Ç¢„ÇØ„Çª„Çπ„Åß„Åç„Åæ„Åõ„Çì" };
      }
    })
  );

  const formatSize = (bytes) => {
    const units = ["B", "KB", "MB", "GB"];
    let size = bytes;
    let unitIndex = 0;
    while (size >= 1024 && unitIndex < units.length - 1) {
      size /= 1024;
      unitIndex++;
    }
    return `${size.toFixed(1)}${units[unitIndex]}`;
  };

  const output = detailedItems
    .map((item) => {
      if (item.error) {
        return `${item.name} (${item.error})`;
      }
      const sizeStr =
        item.type === "directory" ? "<DIR>" : formatSize(item.size);
      return `${item.type === "directory" ? "üìÅ" : "üìÑ"} ${item.name.padEnd(
        30
      )} ${sizeStr.padStart(10)} ${item.modified.substring(0, 19)}`;
    })
    .join("\n");

  return {
    content: [
      {
        type: "text",
        text: `„Éá„Ç£„É¨„ÇØ„Éà„É™: ${directory_path}\n\n${output}`,
      },
    ],
  };
}

// „Éï„Ç°„Ç§„É´Ë™≠„ÅøÂèñ„Çä„ÅÆÂá¶ÁêÜ
async function handleReadFile(args) {
  const { file_path, encoding = "utf8" } = args;

  if (!isPathAllowed(file_path)) {
    throw new Error("ÊåáÂÆö„Åï„Çå„Åü„Éï„Ç°„Ç§„É´„Å∏„ÅÆ„Ç¢„ÇØ„Çª„Çπ„ÅåË®±ÂèØ„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì");
  }

  if (!(await isFileSizeAllowed(file_path))) {
    throw new Error(
      `„Éï„Ç°„Ç§„É´„Çµ„Ç§„Ç∫„ÅåÂà∂ÈôêÔºà${MAX_FILE_SIZE / 1024 / 1024}MBÔºâ„ÇíË∂Ö„Åà„Å¶„ÅÑ„Åæ„Åô`
    );
  }

  const content = await fs.readFile(file_path, encoding);

  return {
    content: [
      {
        type: "text",
        text: `„Éï„Ç°„Ç§„É´: ${file_path}\n\n${content}`,
      },
    ],
  };
}

// „Éï„Ç°„Ç§„É´Êõ∏„ÅçËæº„Åø„ÅÆÂá¶ÁêÜ
async function handleWriteFile(args) {
  const {
    file_path,
    content,
    encoding = "utf8",
    create_directories = true,
  } = args;

  if (!isPathAllowed(file_path)) {
    throw new Error("ÊåáÂÆö„Åï„Çå„Åü„Éï„Ç°„Ç§„É´„Å∏„ÅÆ„Ç¢„ÇØ„Çª„Çπ„ÅåË®±ÂèØ„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì");
  }

  if (create_directories) {
    const dir = path.dirname(file_path);
    await fs.mkdir(dir, { recursive: true });
  }

  await fs.writeFile(file_path, content, encoding);

  return {
    content: [
      {
        type: "text",
        text: `„Éï„Ç°„Ç§„É´ "${file_path}" „Å´Ê≠£Â∏∏„Å´Êõ∏„ÅçËæº„Åø„Åæ„Åó„Åü`,
      },
    ],
  };
}

// „Éï„Ç°„Ç§„É´Ê§úÁ¥¢„ÅÆÂá¶ÁêÜ
async function handleSearchFiles(args) {
  const {
    search_directory,
    query,
    search_type = "both",
    file_extensions = ".txt,.md,.js,.py,.json",
    case_sensitive = false,
  } = args;

  if (!isPathAllowed(search_directory)) {
    throw new Error("ÊåáÂÆö„Åï„Çå„Åü„Éá„Ç£„É¨„ÇØ„Éà„É™„Å∏„ÅÆ„Ç¢„ÇØ„Çª„Çπ„ÅåË®±ÂèØ„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì");
  }

  const extensions = file_extensions.split(",").map((ext) => ext.trim());
  const searchQuery = case_sensitive ? query : query.toLowerCase();
  const results = [];

  async function searchInDirectory(dir) {
    const items = await fs.readdir(dir);

    for (const item of items) {
      const itemPath = path.join(dir, item);

      try {
        const stats = await fs.stat(itemPath);

        if (stats.isDirectory()) {
          await searchInDirectory(itemPath);
        } else {
          const ext = path.extname(item).toLowerCase();
          if (!extensions.includes(ext)) continue;

          // „Éï„Ç°„Ç§„É´ÂêçÊ§úÁ¥¢
          if (search_type === "filename" || search_type === "both") {
            const filename = case_sensitive ? item : item.toLowerCase();
            if (filename.includes(searchQuery)) {
              results.push({
                type: "filename",
                path: itemPath,
                match: item,
              });
            }
          }

          // „Éï„Ç°„Ç§„É´ÂÜÖÂÆπÊ§úÁ¥¢
          if (search_type === "content" || search_type === "both") {
            if (await isFileSizeAllowed(itemPath)) {
              const content = await fs.readFile(itemPath, "utf8");
              const searchContent = case_sensitive
                ? content
                : content.toLowerCase();

              if (searchContent.includes(searchQuery)) {
                // „Éû„ÉÉ„ÉÅ„Åó„ÅüË°å„ÇíÂèñÂæó
                const lines = content.split("\n");
                const matchedLines = lines
                  .map((line, index) => ({ line, number: index + 1 }))
                  .filter(({ line }) => {
                    const checkLine = case_sensitive
                      ? line
                      : line.toLowerCase();
                    return checkLine.includes(searchQuery);
                  })
                  .slice(0, 3); // ÊúÄÂàù„ÅÆ3Ë°å„ÅÆ„Åø

                results.push({
                  type: "content",
                  path: itemPath,
                  matches: matchedLines,
                });
              }
            }
          }
        }
      } catch {
        // „Ç¢„ÇØ„Çª„Çπ„Åß„Åç„Å™„ÅÑ„Éï„Ç°„Ç§„É´„ÅØ„Çπ„Ç≠„ÉÉ„Éó
      }
    }
  }

  await searchInDirectory(search_directory);

  if (results.length === 0) {
    return {
      content: [
        {
          type: "text",
          text: `"${query}" „Å´‰∏ÄËá¥„Åô„ÇãÁµêÊûú„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü`,
        },
      ],
    };
  }

  const output = results
    .slice(0, 20) // ÊúÄÂ§ß20‰ª∂
    .map((result) => {
      if (result.type === "filename") {
        return `üìÑ ${result.path}\n   „Éï„Ç°„Ç§„É´Âêç„Å´„Éû„ÉÉ„ÉÅ: "${result.match}"`;
      } else {
        const matchLines = result.matches
          .map((m) => `   ${m.number}: ${m.line.trim()}`)
          .join("\n");
        return `üìÑ ${result.path}\n${matchLines}`;
      }
    })
    .join("\n\n");

  return {
    content: [
      {
        type: "text",
        text: `Ê§úÁ¥¢ÁµêÊûú (${results.length}‰ª∂‰∏≠ÊúÄÂ§ß20‰ª∂Ë°®Á§∫):\n\n${output}`,
      },
    ],
  };
}

// „Éï„Ç°„Ç§„É´Áµ±Ë®àÊÉÖÂ†±„ÅÆÂá¶ÁêÜ
async function handleGetFileStats(args) {
  const { target_path } = args;

  if (!isPathAllowed(target_path)) {
    throw new Error("ÊåáÂÆö„Åï„Çå„Åü„Éë„Çπ„Å∏„ÅÆ„Ç¢„ÇØ„Çª„Çπ„ÅåË®±ÂèØ„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì");
  }

  const stats = await fs.stat(target_path);

  const formatSize = (bytes) => {
    const units = ["B", "KB", "MB", "GB"];
    let size = bytes;
    let unitIndex = 0;
    while (size >= 1024 && unitIndex < units.length - 1) {
      size /= 1024;
      unitIndex++;
    }
    return `${size.toFixed(2)} ${units[unitIndex]}`;
  };

  const info = {
    path: target_path,
    type: stats.isDirectory() ? "„Éá„Ç£„É¨„ÇØ„Éà„É™" : "„Éï„Ç°„Ç§„É´",
    size: formatSize(stats.size),
    created: stats.birthtime.toLocaleString("ja-JP"),
    modified: stats.mtime.toLocaleString("ja-JP"),
    accessed: stats.atime.toLocaleString("ja-JP"),
    permissions: stats.mode.toString(8),
  };

  const output = Object.entries(info)
    .map(([key, value]) => `${key}: ${value}`)
    .join("\n");

  return {
    content: [
      {
        type: "text",
        text: output,
      },
    ],
  };
}

// „Éï„Ç°„Ç§„É´ÂâäÈô§„ÅÆÂá¶ÁêÜ
async function handleDeleteFile(args) {
  if (SAFE_MODE) {
    throw new Error("„Çª„Éº„Éï„É¢„Éº„Éâ„ÅåÊúâÂäπ„Å™„Åü„ÇÅ„ÄÅÂâäÈô§Êìç‰Ωú„ÅØÁÑ°ÂäπÂåñ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô");
  }

  const { target_path, recursive = false } = args;

  if (!isPathAllowed(target_path)) {
    throw new Error("ÊåáÂÆö„Åï„Çå„Åü„Éë„Çπ„Å∏„ÅÆ„Ç¢„ÇØ„Çª„Çπ„ÅåË®±ÂèØ„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì");
  }

  const stats = await fs.stat(target_path);

  if (stats.isDirectory()) {
    if (recursive) {
      await fs.rm(target_path, { recursive: true });
      return {
        content: [
          {
            type: "text",
            text: `„Éá„Ç£„É¨„ÇØ„Éà„É™ "${target_path}" „ÇíÂÜçÂ∏∞ÁöÑ„Å´ÂâäÈô§„Åó„Åæ„Åó„Åü`,
          },
        ],
      };
    } else {
      await fs.rmdir(target_path);
      return {
        content: [
          {
            type: "text",
            text: `„Éá„Ç£„É¨„ÇØ„Éà„É™ "${target_path}" „ÇíÂâäÈô§„Åó„Åæ„Åó„Åü`,
          },
        ],
      };
    }
  } else {
    await fs.unlink(target_path);
    return {
      content: [
        {
          type: "text",
          text: `„Éï„Ç°„Ç§„É´ "${target_path}" „ÇíÂâäÈô§„Åó„Åæ„Åó„Åü`,
        },
      ],
    };
  }
}

// „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞
server.onerror = (error) => {
  console.error("[MCP Error]", error);
};

// „Çµ„Éº„Éê„Éº„ÅÆËµ∑Âãï
async function main() {
  console.log("File System Manager MCP Server");
  console.log("Ë®±ÂèØ„Åï„Çå„Åü„Éá„Ç£„É¨„ÇØ„Éà„É™:", ALLOWED_DIRECTORIES);
  console.log("ÊúÄÂ§ß„Éï„Ç°„Ç§„É´„Çµ„Ç§„Ç∫:", `${MAX_FILE_SIZE / 1024 / 1024}MB`);
  console.log("„Çª„Éº„Éï„É¢„Éº„Éâ:", SAFE_MODE ? "ÊúâÂäπ" : "ÁÑ°Âäπ");

  const transport = new StdioServerTransport();
  await server.connect(transport);
  console.log("Server running on stdio");
}

main().catch((error) => {
  console.error("Failed to start server:", error);
  process.exit(1);
});
```

## üì¶ „Çπ„ÉÜ„ÉÉ„Éó 5: „Éì„É´„Éâ„Å®„ÉÜ„Çπ„Éà

### ‰æùÂ≠òÈñ¢‰øÇ„ÅÆ„Ç§„É≥„Çπ„Éà„Éº„É´

```bash
cd server
npm install
cd ..
```

### „É≠„Éº„Ç´„É´„ÉÜ„Çπ„Éà

```bash
cd server
node index.js
```

### DXT „Éï„Ç°„Ç§„É´„ÅÆ‰ΩúÊàê

```bash
dxt validate
dxt pack
```

## üîß „Çπ„ÉÜ„ÉÉ„Éó 6: „Çª„Ç≠„É•„É™„ÉÜ„Ç£Ë®≠ÂÆö

### „Ç§„É≥„Çπ„Éà„Éº„É´ÊôÇ„ÅÆ„É¶„Éº„Ç∂„ÉºË®≠ÂÆö

DXT „Çí„Ç§„É≥„Çπ„Éà„Éº„É´„Åô„ÇãÈöõ„ÄÅ‰ª•‰∏ã„ÅÆË®≠ÂÆö„ÅåÊ±Ç„ÇÅ„Çâ„Çå„Åæ„ÅôÔºö

1. **Ë®±ÂèØ„Éá„Ç£„É¨„ÇØ„Éà„É™**: „Ç¢„ÇØ„Çª„Çπ„ÇíË®±ÂèØ„Åô„Çã„Éá„Ç£„É¨„ÇØ„Éà„É™„ÅÆ„Éë„Çπ
2. **ÊúÄÂ§ß„Éï„Ç°„Ç§„É´„Çµ„Ç§„Ç∫**: Ë™≠„ÅøÂèñ„ÇäÂèØËÉΩ„Å™ÊúÄÂ§ß„Éï„Ç°„Ç§„É´„Çµ„Ç§„Ç∫
3. **„Çª„Éº„Éï„É¢„Éº„Éâ**: ÂâäÈô§Êìç‰Ωú„ÅÆÊúâÂäπ/ÁÑ°Âäπ

### Êé®Â•®Ë®≠ÂÆö‰æã

```
Ë®±ÂèØ„Éá„Ç£„É¨„ÇØ„Éà„É™: /Users/USERNAME/Documents,/Users/USERNAME/Desktop,/Users/USERNAME/Projects
ÊúÄÂ§ß„Éï„Ç°„Ç§„É´„Çµ„Ç§„Ç∫: 5
„Çª„Éº„Éï„É¢„Éº„Éâ: true
```

## üß™ „Çπ„ÉÜ„ÉÉ„Éó 7: Âãï‰ΩúÁ¢∫Ë™ç

### 1. „Éá„Ç£„É¨„ÇØ„Éà„É™‰∏ÄË¶ßË°®Á§∫

```
Documents„Éï„Ç©„É´„ÉÄ„ÅÆÂÜÖÂÆπ„ÇíË©≥Á¥∞ÊÉÖÂ†±‰ªò„Åç„ÅßË°®Á§∫„Åó„Å¶„Åè„Å†„Åï„ÅÑ
```

### 2. „Éï„Ç°„Ç§„É´Ë™≠„ÅøÂèñ„Çä

```
Desktop/sample.txt„Éï„Ç°„Ç§„É´„ÅÆÂÜÖÂÆπ„ÇíË™≠„ÅøÂèñ„Å£„Å¶„Åè„Å†„Åï„ÅÑ
```

### 3. „Éï„Ç°„Ç§„É´‰ΩúÊàê

```
Desktop/test.txt„Éï„Ç°„Ç§„É´„Å´„ÄåHello, DXT!„Äç„Å®Êõ∏„ÅçËæº„Çì„Åß„Åè„Å†„Åï„ÅÑ
```

### 4. „Éï„Ç°„Ç§„É´Ê§úÁ¥¢

```
Documents„Éï„Ç©„É´„ÉÄÂÜÖ„Åß„ÄåJavaScript„Äç„Å®„ÅÑ„ÅÜÂçòË™û„ÇíÂê´„ÇÄ„Éï„Ç°„Ç§„É´„ÇíÊ§úÁ¥¢„Åó„Å¶„Åè„Å†„Åï„ÅÑ
```

### 5. „Éï„Ç°„Ç§„É´Áµ±Ë®à

```
Documents„Éï„Ç©„É´„ÉÄ„ÅÆÁµ±Ë®àÊÉÖÂ†±„ÇíÂèñÂæó„Åó„Å¶„Åè„Å†„Åï„ÅÑ
```

## üîç „Éà„É©„Éñ„É´„Ç∑„É•„Éº„ÉÜ„Ç£„É≥„Ç∞

### „Éë„Éº„Éü„ÉÉ„Ç∑„Éß„É≥„Ç®„É©„Éº

```bash
# macOS„Åß„ÅÆ„Éï„É´„Éá„Ç£„Çπ„ÇØ„Ç¢„ÇØ„Çª„ÇπË®±ÂèØ
# „Ç∑„Çπ„ÉÜ„É†Áí∞Â¢ÉË®≠ÂÆö > „Çª„Ç≠„É•„É™„ÉÜ„Ç£„Å®„Éó„É©„Ç§„Éê„Ç∑„Éº > „Éó„É©„Ç§„Éê„Ç∑„Éº > „Éï„É´„Éá„Ç£„Çπ„ÇØ„Ç¢„ÇØ„Çª„Çπ
# Claude Desktop„ÇíËøΩÂä†
```

### „Éï„Ç°„Ç§„É´„ÅåË™≠„ÅøÂèñ„Çå„Å™„ÅÑ

- „Éï„Ç°„Ç§„É´„Çµ„Ç§„Ç∫„ÅåÂà∂Èôê„ÇíË∂Ö„Åà„Å¶„ÅÑ„Å™„ÅÑ„ÅãÁ¢∫Ë™ç
- „Éï„Ç°„Ç§„É´„ÅÆ„Ç®„É≥„Ç≥„Éº„Éá„Ç£„É≥„Ç∞„ÅåÊ≠£„Åó„ÅÑ„ÅãÁ¢∫Ë™ç
- Ë®±ÂèØ„Åï„Çå„Åü„Éá„Ç£„É¨„ÇØ„Éà„É™ÂÜÖ„Å´„ÅÇ„Çã„ÅãÁ¢∫Ë™ç

## üéØ ÂøúÁî®‰æã

„Åì„ÅÆÊã°ÂºµÊ©üËÉΩ„ÇíÂü∫„Å´„Åó„Å¶„ÄÅ‰ª•‰∏ã„ÅÆ„Çà„ÅÜ„Å™Ê©üËÉΩËøΩÂä†„ÅåÂèØËÉΩ„Åß„ÅôÔºö

- üìÑ **ÊñáÊõ∏Ëß£Êûê**: PDF„ÄÅWord ÊñáÊõ∏„ÅÆÂÜÖÂÆπËß£Êûê
- üñºÔ∏è **ÁîªÂÉèÂá¶ÁêÜ**: ÁîªÂÉè„É°„Çø„Éá„Éº„Çø„ÅÆÂèñÂæó„ÄÅ„É™„Çµ„Ç§„Ç∫
- üóúÔ∏è **„Ç¢„Éº„Ç´„Ç§„ÉñÊìç‰Ωú**: ZIP„ÄÅTAR.GZ „Éï„Ç°„Ç§„É´„ÅÆÂ±ïÈñã
- üîÑ **ÂêåÊúüÊ©üËÉΩ**: Ë§áÊï∞„Éá„Ç£„É¨„ÇØ„Éà„É™Èñì„ÅÆ„Éï„Ç°„Ç§„É´ÂêåÊúü

Ê¨°„ÅØ [„Éá„Éº„Çø„Éô„Éº„ÇπÈÄ£Êê∫](./04-database-example.md) „Å´ÈÄ≤„Çì„Åß„ÄÅ„Åï„Çâ„Å´È´òÂ∫¶„Å™Ê©üËÉΩ„ÇíÂ≠¶Áøí„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ
